<a class="btn btn-link mb-3" routerLink="/formations">← Retour aux formations</a>

<ng-container *ngIf="formation">
<section>
  <h1>{{ formation.titre }}</h1>
  <p>{{ formation.description }}</p>
  <ul class="list-unstyled">
    <li><strong>Durée :</strong> {{ formation.heures }} heures</li>
    <li><strong>Niveau :</strong> {{ formation.difficulte }}</li>
    <li><strong>Programme :</strong> {{ formation.programPdf || 'PDF non disponible' }}</li>
  </ul>
  <div class="mb-3">
    <ng-container *ngFor="let tag of formation.tags">
    <span class="badge bg-info text-dark me-1">{{ tag }}</span>
</ng-container>
  </div>
</section>

<section>
  <h2>Sessions à venir</h2>
  <ng-container *ngIf="sessions.length > 0">
  <div class="accordion" id="sessionsAccordion">
    <ng-container *ngFor="let session of sessions">
    <div class="accordion-item">
      <h2 class="accordion-header" id="heading-{{ session.id }}">
        <button
          class="accordion-button collapsed"
          type="button"
          data-bs-toggle="collapse"
          [attr.data-bs-target]="'#collapse-' + session.id"
        >
          Session {{ session.id }} • {{ session.dateDebut | date: 'dd/MM/yyyy' }} -
          {{ session.dateFin | date: 'dd/MM/yyyy' }}
        </button>
      </h2>
      <div
        class="accordion-collapse collapse"
        [id]="'collapse-' + session.id"
        [attr.aria-labelledby]="'heading-' + session.id"
        data-bs-parent="#sessionsAccordion"
      >
        <div class="accordion-body">
          <p>{{ session.description }}</p>
          <p>
            <strong>Inscrits :</strong> {{ session.candidatsInscrits.length }}/{{
              session.maxInscrits
            }}
          </p>
            <div *ngIf="isSessionFull(session)">
              <div class="alert alert-warning">Session complète, inscriptions désactivées.</div>
            </div>
            <div *ngIf="!isSessionFull(session)">
              <app-inscription-form (register)="onRegister(session, $event)"></app-inscription-form>
            </div>
          <ng-container *ngIf="registrationMessage[session.id]">
          <div
            class="alert mt-3"
            [class.alert-success]="registrationStatus[session.id] === 'success'"
            [class.alert-danger]="registrationStatus[session.id] === 'error'"
          >
            {{ registrationMessage[session.id] }}
          </div>
</ng-container>
        </div>
      </div>
    </div>
</ng-container>
  </div>
  </ng-container>

  <ng-template #noSessions>
    <p>Aucune session programmée pour cette formation.</p>
  </ng-template>
</section>
</ng-container>
<ng-container *ngIf="!formation">
  <p>Formation introuvable.</p>
</ng-container>